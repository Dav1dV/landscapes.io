{
  "AWSTemplateFormatVersion":"2010-09-09",
  "Description":"HMS DevOps Group",
  "Parameters":{
    "VpcId":{
      "Description":"Id of VPC",
      "Type":"String",
      "Default":"vpc-aac6cec8"
    },
    "subnetId1":{
      "Description":"Id of the subnet for these boxes",
      "Type":"String",
      "Default":"subnet-4e6b5f3a"
    },
    "subnetId2":{
      "Description":"2nd Id of the subnet for these boxes",
      "Type":"String",
      "Default":"subnet-13abfc55"
    },
    "DBSubnetSGId":{
      "Description":"Id of security group for these boxes",
      "Type":"String",
      "Default":"sg-9e0aa0fb"
    },
    "HostedZoneId":{
      "Description":"Id of the hosted zone for route 53 records",
      "Type":"String",
      "Default":"Z1M4YZQRZ35LRA"
    },
    "Environment":{
      "Description":"Name of the environment for deployment",
      "Type":"String",
      "Default":"sit"
    },
    "DBUser":{
      "Description":"Name of the environment for deployment",
      "Type":"String",
      "Default":"urthecast"
    },
    "DBPassword":{
      "Description":"Name of the environment for deployment",
      "Type":"String",
      "Default":"urthecast"
    }
  },
  "Mappings":{
    "IPMap":{
      "dev":{
        "ipSpace":"10.22"
      },
      "sit":{
        "ipSpace":"10.21"
      }
    },
    "EnvMap":{
      "dev":{
        "ChefBucketName":"urthecast-devdevops",
        "imageId":"ami-6f8f9206",
        "KeyName":"urthecast-dev"
      },
      "sit":{
        "ChefBucketName":"urthecast-sit-devops",
        "imageId":"ami-6f8f9206",
        "KeyName":"sit"
      }
    }
  },
  "Resources":{
    "DBSubnetGroup":{
      "Type":"AWS::RDS::DBSubnetGroup",
      "Properties":{
        "DBSubnetGroupDescription":"Subnet Group for Postgres DB's",
        "SubnetIds":[
          {
            "Ref":"subnetId1"
          },
          {
            "Ref":"subnetId2"
          }
        ],
        "Tags":[
          {
            "Key":"CostCenter",
            "Value":"gs"
          }
        ]
      }
    },
    "HMSPostgresDB":{
      "Type":"AWS::RDS::DBInstance",
      "Properties":{
        "AllocatedStorage":"200",
        "Tags":[
          {
            "Key":"Name",
            "Value":"hms-postgres"
          },
          {
            "Key":"CostCenter",
            "Value":"gs"
          }
        ],
        "DBInstanceClass":"db.m1.medium",
        "DBSubnetGroupName":{
          "Ref":"DBSubnetGroup"
        },
        "Engine":"postgres",
        "EngineVersion":"9.3.1",
        "MasterUsername":{
          "Ref":"DBUser"
        },
        "MasterUserPassword":{
          "Ref":"DBPassword"
        },
        "VPCSecurityGroups":[
          {
            "Ref":"DBSubnetSGId"
          }
        ]
      }
    },
    "HMSdbDNSRecord":{
      "Type":"AWS::Route53::RecordSet",
      "Properties":{
        "HostedZoneId":{
          "Ref":"HostedZoneId"
        },
        "Comment":"DNS name for my instance.",
        "Name":{
          "Fn::Join":[
            "",
            [
              "hms-postgres",
              ".",
              {
                "Ref":"Environment"
              },
              ".",
              "urthecast.com"
            ]
          ]
        },
        "Type":"CNAME",
        "TTL":"900",
        "ResourceRecords":[
          {
            "Fn::GetAtt":[
              "HMSPostgresDB",
              "Endpoint.Address"
            ]
          }
        ]
      }
    }
  }
}
